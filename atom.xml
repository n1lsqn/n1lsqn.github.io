<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>BackDoor</title>
  
  
  <link href="https://n1lsqn.github.io/atom.xml" rel="self"/>
  
  <link href="https://n1lsqn.github.io/"/>
  <updated>2024-10-31T23:08:00.275Z</updated>
  <id>https://n1lsqn.github.io/</id>
  
  <author>
    <name>n1lsqn</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SteamVRを起動したらモニターの接続を解除してVRChatのパフォーマンスを改善する</title>
    <link href="https://n1lsqn.github.io/2024/11/01/monitor-control/"/>
    <id>https://n1lsqn.github.io/2024/11/01/monitor-control/</id>
    <published>2024-11-01T07:11:30.000Z</published>
    <updated>2024-10-31T23:08:00.275Z</updated>
    
    <content type="html"><![CDATA[<p>最近VR機器を使うことが増えてきており、マルチモニター環境においてSteamVRやVRChat等のVRゲームを起動したときに、モニターの接続を解除してあげるとFPSが自環境では5-10FPSの向上が見られたので備忘録。</p><span id="more"></span><!-- toc --><h1 id="multimonitortoolの準備"><a href="#multimonitortoolの準備" class="headerlink" title="multimonitortoolの準備"></a>multimonitortoolの準備</h1><p><a href="https://www.nirsoft.net/utils/multi_monitor_tool.html">multimonitortool</a>をダウンロード。結構下のほうにあるのでCtrl+FでDownloadと検索したほうが幸せかもしれない。Languageにある日本語化ファイルもダウンロードしておく。</p><h1 id="multimonitortoolでモニターIDの確認"><a href="#multimonitortoolでモニターIDの確認" class="headerlink" title="multimonitortoolでモニターIDの確認"></a>multimonitortoolでモニターIDの確認</h1><img src="/2024/11/01/monitor-control/%7B2275EDBB-9E33-4D0F-945F-E54DA39CCF39%7D.png" class=""><p>起動して、モニターidを取得する。<br>下部分に表示されているウィンドウと照らし合わせながら、モニターを右クリック</p><img src="/2024/11/01/monitor-control/%7B82CD15FE-57B8-424B-8C19-6DD341C76DF6%7D.png" class=""><p>モニターIDをメモしておく</p><h1 id="batファイルの作成"><a href="#batファイルの作成" class="headerlink" title="batファイルの作成"></a>batファイルの作成</h1><p>off時のbat</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">setlocal</span></span><br><span class="line"></span><br><span class="line">:: monitor IDs</span><br><span class="line"><span class="built_in">set</span> &quot;MAIN_MONITOR_ID=MONITOR\*******\&#123;*******-****-****-****-************&#125;\****&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;SUB1_MONITOR_ID=MONITOR\*******\&#123;*******-****-****-****-************&#125;\****&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;SUB2_MONITOR_ID=MONITOR\*******\&#123;*******-****-****-****-************&#125;\****&quot;</span><br><span class="line"></span><br><span class="line">:: MultiMonitorToolで切断</span><br><span class="line">&quot;MultiMonitorTool.exe&quot; /disable &quot;<span class="variable">%SUB1_MONITOR_ID%</span>&quot;</span><br><span class="line">&quot;MultiMonitorTool.exe&quot; /disable &quot;<span class="variable">%SUB2_MONITOR_ID%</span>&quot;</span><br><span class="line"></span><br><span class="line">:: 自動的に閉じる</span><br><span class="line">timeout /t <span class="number">3</span> &gt;<span class="built_in">nul</span></span><br></pre></td></tr></table></figure><p>on時のbat</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">setlocal</span></span><br><span class="line"></span><br><span class="line">:: Define monitor IDs</span><br><span class="line"><span class="built_in">set</span> &quot;MAIN_MONITOR_ID=MONITOR\*******\&#123;*******-****-****-****-************&#125;\****&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;SUB1_MONITOR_ID=MONITOR\*******\&#123;*******-****-****-****-************&#125;\****&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;SUB2_MONITOR_ID=MONITOR\*******\&#123;*******-****-****-****-************&#125;\****&quot;</span><br><span class="line"></span><br><span class="line">:: MultiMonitorToolで切断</span><br><span class="line">&quot;MultiMonitorTool.exe&quot; /enable &quot;<span class="variable">%SUB1_MONITOR_ID%</span>&quot;</span><br><span class="line">&quot;MultiMonitorTool.exe&quot; /enable &quot;<span class="variable">%SUB2_MONITOR_ID%</span>&quot;</span><br><span class="line"></span><br><span class="line">:: 自動的に閉じる</span><br><span class="line">timeout /t <span class="number">3</span> &gt;<span class="built_in">nul</span></span><br></pre></td></tr></table></figure><p>まず<code>set MAIN_MONITOR_ID</code>、<code>set SUB1_MONITOR_ID</code>、<code>set SUB2_MONITOR_ID</code>でモニターIDを定義、私はトリプル環境のため三つ定義してあるため、各々そこは変更していただきたい。</p><p><code>&quot;MultiMonitorTool.exe&quot;</code>はMultiMonitorTool.exeが配置されている絶対パス(エクスプローラーでexeを指定し右クリック -&gt; パスのコピーで取得)を指定</p><p>これでとりあえず接続&#x2F;切断は使えるはず。</p><h1 id="autohotkeyの構築"><a href="#autohotkeyの構築" class="headerlink" title="autohotkeyの構築"></a>autohotkeyの構築</h1><p><a href="https://www.autohotkey.com/">autohotkey</a>を使ってSteamVR<code>vrserver.exe</code>が起動したときに切断、終了時に接続というようなことをする。ダウンロードしてインストールしておく。</p><figure class="highlight ahk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#Persistent</span></span><br><span class="line"><span class="built_in">SetTimer,</span> CheckSteamVR, <span class="number">1000</span></span><br><span class="line">steamVRStarted := <span class="literal">false</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="title">CheckSteamVR:</span></span><br><span class="line"><span class="built_in">Process,</span> Exist, vrserver.exe</span><br><span class="line">if (<span class="built_in">ErrorLevel</span> != <span class="number">0</span> <span class="literal">and</span> !steamVRStarted) &#123;</span><br><span class="line">    <span class="comment">; SteamVR起動時に実行</span></span><br><span class="line"><span class="built_in">    Run,</span> <span class="string">&quot;off.bat&quot;</span></span><br><span class="line">    steamVRStarted := <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">else if (<span class="built_in">ErrorLevel</span> == <span class="number">0</span> <span class="literal">and</span> steamVRStarted) &#123;</span><br><span class="line">    <span class="comment">; SteamVR終了時に実行</span></span><br><span class="line"><span class="built_in">    Run,</span> <span class="string">&quot;on.bat&quot;</span></span><br><span class="line">    steamVRStarted := <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br></pre></td></tr></table></figure><p><code>off.bat</code>と<code>on.bat</code>は先ほどのパスをコピーから取得する</p><p>先ほど書いたahkファイルを開くと</p><img src="/2024/11/01/monitor-control/%7BC695ED36-8484-413B-809D-B34F37F620CB%7D.png" class=""> <p>といわれるのではいを選択、now installみたいなウィンドウが出てきたらok。<br>またahkファイルを開いてシステムトレイに追加されてたらok。緑でHと書いてあるロゴがそれ</p><img src="/2024/11/01/monitor-control/%7B73A5AC60-1C32-4DA3-8954-42F0548F1215%7D.png" class=""><p>だいぶ駆け足気味で書いているので、わかんなかったら遠慮なくTwitterのDMまでぜひ</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://note.com/ngc_shj/n/n257e2c5b991c">WSL2でマルチディスプレイの接続&#x2F;切断をCLIで行う</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近VR機器を使うことが増えてきており、マルチモニター環境においてSteamVRやVRChat等のVRゲームを起動したときに、モニターの接続を解除してあげるとFPSが自環境では5-10FPSの向上が見られたので備忘録。&lt;/p&gt;</summary>
    
    
    
    
    <category term="SteamVR" scheme="https://n1lsqn.github.io/tags/SteamVR/"/>
    
    <category term="VRChar" scheme="https://n1lsqn.github.io/tags/VRChar/"/>
    
  </entry>
  
  <entry>
    <title>misskeyのdbをバックアップから復元する。</title>
    <link href="https://n1lsqn.github.io/2024/02/27/misskey-migration/"/>
    <id>https://n1lsqn.github.io/2024/02/27/misskey-migration/</id>
    <published>2024-02-27T14:13:21.000Z</published>
    <updated>2024-10-31T22:58:10.774Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pg-dumpでバックアップを取得し、psqlで復元する。"><a href="#pg-dumpでバックアップを取得し、psqlで復元する。" class="headerlink" title="pg_dumpでバックアップを取得し、psqlで復元する。"></a>pg_dumpでバックアップを取得し、psqlで復元する。</h1><p>すでにバックアップは準備できているものとする。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres psql</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE mk1 OWNER misskey;</span><br></pre></td></tr></table></figure><p>拡張機能を入れている場合は、拡張機能をインストールする。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> EXTENSION pgroonga;</span><br></pre></td></tr></table></figure><h1 id="バックアップから復元する。"><a href="#バックアップから復元する。" class="headerlink" title="バックアップから復元する。"></a>バックアップから復元する。</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -d mk1 &lt; backup.sql</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pg-dumpでバックアップを取得し、psqlで復元する。&quot;&gt;&lt;a href=&quot;#pg-dumpでバックアップを取得し、psqlで復元する。&quot; class=&quot;headerlink&quot; title=&quot;pg_dumpでバックアップを取得し、psqlで復元する。&quot;&gt;&lt;/a</summary>
      
    
    
    
    
    <category term="misskey" scheme="https://n1lsqn.github.io/tags/misskey/"/>
    
  </entry>
  
  <entry>
    <title>dockerにはコンテナ当たりの容量制限があるという話。</title>
    <link href="https://n1lsqn.github.io/2023/12/02/docker-rimit/"/>
    <id>https://n1lsqn.github.io/2023/12/02/docker-rimit/</id>
    <published>2023-12-02T23:13:33.000Z</published>
    <updated>2024-10-31T22:58:10.774Z</updated>
    
    <content type="html"><![CDATA[<p>知らなかったのだが、Dockerにはコンテナ当たりの容量制限があるらしい。<br>経緯としては、ストレージがあるのにもかかわらず、no space left on deviceというエラーが出てしまうというもの。</p><span id="more"></span><!-- toc --><p><a href="https://unrealcontainers.com/docs/environments/local-windows-10#:~:text=By%20default%2C%20Docker%20Desktop%20for,by%20following%20the%20instructions%20below">Local Development (Windows 10)</a></p><blockquote><p>By default, Docker Desktop for Windows imposes a 20GB size limit on container images, which is too low for building and running Unreal Engine containers. You will need to increase the maximum container disk size to the recommended limit of 300GB by following the instructions below.</p></blockquote><h3 id="設定"><a href="#設定" class="headerlink" title="設定"></a>設定</h3><p>Docker Desktopの設定から、Docker Engineの設定を開き、<code>&quot;defaultKeepStorage&quot;: &quot;20GB&quot;,</code>を<code>&quot;defaultKeepStorage&quot;: &quot;200GB&quot;,</code>に変更する。（各々好きな値で）</p><p>おしまい。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;知らなかったのだが、Dockerにはコンテナ当たりの容量制限があるらしい。&lt;br&gt;経緯としては、ストレージがあるのにもかかわらず、no space left on deviceというエラーが出てしまうというもの。&lt;/p&gt;</summary>
    
    
    
    
    <category term="docker" scheme="https://n1lsqn.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Misskeyでハイライトやサーバークラウドのアイコンがおかしい問題の対処法</title>
    <link href="https://n1lsqn.github.io/2023/11/20/misskey-redis/"/>
    <id>https://n1lsqn.github.io/2023/11/20/misskey-redis/</id>
    <published>2023-11-20T01:28:06.000Z</published>
    <updated>2024-10-31T22:58:10.774Z</updated>
    
    <content type="html"><![CDATA[<h4 id="問題点"><a href="#問題点" class="headerlink" title="問題点"></a>問題点</h4><ul><li>ハイライトが表示されない</li><li>サーバークラウドのアイコンが表示されない</li></ul><span id="more"></span><!-- toc --><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><ul><li>Redisが古いことが原因<br>不確かだが、v7以上が必須のはずがv6が入っていた</li></ul><h4 id="対処法"><a href="#対処法" class="headerlink" title="対処法"></a>対処法</h4><ul><li>Redisを最新版にアップデートする</li></ul><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y curl ca-certificates gnupg2 lsb-release</span><br><span class="line"></span><br><span class="line">curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb <span class="subst">$(lsb_release -cs)</span> main&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/redis.list</span><br><span class="line"></span><br><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line">sudo apt install -y redis</span><br></pre></td></tr></table></figure><p>これでok。ついでにPostgreSQLも古いバージョンを利用していたためアップデートした</p><h4 id="PostgresSQLのアップデート"><a href="#PostgresSQLのアップデート" class="headerlink" title="PostgresSQLのアップデート"></a>PostgresSQLのアップデート</h4><p><strong>必ずpg_dump等でバックアップを取ってから行うこと</strong></p><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install postgresql-15</span><br><span class="line">sudo pg_dropcluster 15 main --stop</span><br><span class="line">sudo pg_upgradecluster -v 15 14 main</span><br></pre></td></tr></table></figure><p><code>pg_updatecluster</code>で自動的にアップデートされ切り替わるので少しビビった</p><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul><li><a href="https://misskey-hub.net/docs/install/ubuntu-manual.html#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AEmisskey%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95">Ubuntu版Misskeyインストール方法詳説</a></li><li><a href="https://qiita.com/ynott/items/ca130c4b70533a91d3d3">Ubuntu 22.04 LTS で Postgresql 13から15にアップグレードした話(pg_upgradecluster編)</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h4 id=&quot;問題点&quot;&gt;&lt;a href=&quot;#問題点&quot; class=&quot;headerlink&quot; title=&quot;問題点&quot;&gt;&lt;/a&gt;問題点&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ハイライトが表示されない&lt;/li&gt;
&lt;li&gt;サーバークラウドのアイコンが表示されない&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="misskey" scheme="https://n1lsqn.github.io/tags/misskey/"/>
    
    <category term="redis" scheme="https://n1lsqn.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Misskey 2023.11.0にmeilisearchを導入する</title>
    <link href="https://n1lsqn.github.io/2023/11/20/misskey-meilisearch/"/>
    <id>https://n1lsqn.github.io/2023/11/20/misskey-meilisearch/</id>
    <published>2023-11-20T01:27:06.000Z</published>
    <updated>2024-10-31T22:58:10.774Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Misskeyにmeilisearchを導入する方法"><a href="#Misskeyにmeilisearchを導入する方法" class="headerlink" title="Misskeyにmeilisearchを導入する方法"></a>Misskeyにmeilisearchを導入する方法</h3><span id="more"></span><!-- toc --><p>読み飛ばしたい人は6まで飛ばすことをお勧めする</p><h4 id="meilisearchのインストール"><a href="#meilisearchのインストール" class="headerlink" title="meilisearchのインストール"></a>meilisearchのインストール</h4><p><a href="https://www.meilisearch.com/docs/learn/cookbooks/running_production">公式ドキュメント</a>をもとに進めていく</p><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install curl -y</span><br><span class="line">curl -L https://install.meilisearch.com | sh</span><br><span class="line"><span class="built_in">chmod</span> +x meilisearch</span><br><span class="line">sudo <span class="built_in">mv</span> ./meilisearch /usr/local/bin/</span><br><span class="line">sudo useradd -d /var/lib/meilisearch -b /bin/false -m -r meilisearch</span><br></pre></td></tr></table></figure><h4 id="設定ファイルの書き換え"><a href="#設定ファイルの書き換え" class="headerlink" title="設定ファイルの書き換え"></a>設定ファイルの書き換え</h4><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.githubusercontent.com/meilisearch/meilisearch/latest/config.toml &gt; meilisearch.toml</span><br><span class="line">nano meilisearch.toml</span><br></pre></td></tr></table></figure><p>master_keyは16バイト以上に必要らしいので、以下のコマンドで生成する</p><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install uuid</span><br><span class="line">uuid</span><br></pre></td></tr></table></figure><figure class="highlight toml"><figcaption><span>meilisearch.toml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env</span> = <span class="string">&quot;production&quot;</span></span><br><span class="line"><span class="attr">master_key</span> = <span class="string">&quot;YOUR_MASTER_KEY_VALUE&quot;</span></span><br><span class="line"><span class="attr">db_path</span> = <span class="string">&quot;/var/lib/meilisearch/data&quot;</span></span><br><span class="line"><span class="attr">dump_dir</span> = <span class="string">&quot;/var/lib/meilisearch/dumps&quot;</span></span><br><span class="line"><span class="attr">snapshot_dir</span> = <span class="string">&quot;/var/lib/meilisearch/snapshots&quot;</span></span><br></pre></td></tr></table></figure><p>以上の点を書き換え後、<code>sudo mv meilisearch.toml /etc/meilisearch/</code>で設定ファイルを移動する</p><p>移動後、ディレクトリを生成する</p><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /var/lib/meilisearch/data /var/lib/meilisearch/dumps /var/lib/meilisearch/snapshots</span><br><span class="line">sudo <span class="built_in">chown</span> -R meilisearch:meilisearch /var/lib/meilisearch</span><br><span class="line">sudo <span class="built_in">chmod</span> 750 /var/lib/meilisearch</span><br></pre></td></tr></table></figure><h4 id="サービスの起動"><a href="#サービスの起動" class="headerlink" title="サービスの起動"></a>サービスの起動</h4><p><code>sudo nano /etc/systemd/system/meilisearch.service</code></p><figure class="highlight plaintext"><figcaption><span>/etc/systemd/system/meilisearch.service</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Meilisearch</span><br><span class="line">After=systemd-user-sessions.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">WorkingDirectory=/var/lib/meilisearch</span><br><span class="line">ExecStart=/usr/local/bin/meilisearch --config-file-path /etc/meilisearch.toml</span><br><span class="line">User=meilisearch</span><br><span class="line">Group=meilisearch</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> meilisearch</span><br><span class="line">sudo systemctl start meilisearch</span><br><span class="line">sudo systemctl status meilisearch</span><br></pre></td></tr></table></figure><h4 id="APIキーの取得"><a href="#APIキーの取得" class="headerlink" title="APIキーの取得"></a>APIキーの取得</h4><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl \</span><br><span class="line">  -X GET <span class="string">&#x27;http://localhost:7700/keys&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Authorization: Bearer MASTER_KEY&#x27;</span></span><br></pre></td></tr></table></figure><p><code>MASTER_KEY</code>にはmeilisearch.tomlで設定したmaster_keyを入れる</p><p>次のように返ってくるため</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;results&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Default Search API Key&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Use it to search from the frontend&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d0552b41536279a0ad88bd595327b96f01176a60c2243e906c52ac02375f9bc4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span><span class="string">&quot;74c9c733-3368-4738-bbe5-1d18a5fecb37&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;search&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;indexes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;expiresAt&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createdAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-01T10:00:00Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updatedAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-01T10:00:00Z&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Default Admin API Key&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Use it for all other than search operations. Caution! Do not expose it on a public frontend&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;380689dd379232519a54d15935750cc7625620a2ea2fc06907cb40ba5b421b6f&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20f7e4c4-612c-4dd1-b783-7934cc038213&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;indexes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;expiresAt&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createdAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-08-11T10:00:00Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updatedAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-08-11T10:00:00Z&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Search patient records key&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d0552b41536279a0ad88bd595327b96f01176a60c2243e906c52ac02375f9bc4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ac5cd97d-5a4b-4226-a868-2d0eb6d197ab&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;search&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;indexes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;patient_medical_records&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;expiresAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-01-01T00:00:00Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createdAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-01T10:00:00Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updatedAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-01T10:00:00Z&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;offset&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;limit&quot;</span><span class="punctuation">:</span><span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="number">3</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Default Admin API Keyの<code>key</code>をコピーする</p><h4 id="Misskeyの設定"><a href="#Misskeyの設定" class="headerlink" title="Misskeyの設定"></a>Misskeyの設定</h4><p>misskeyの設定ファイルを開く</p><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /home/misskey/config/default.yaml</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><figcaption><span>/home/misskey/config/default.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meilisearch:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7700</span></span><br><span class="line">  <span class="attr">apiKey:</span> <span class="string">&#x27;先ほどコピーしたkeyを入れる&#x27;</span></span><br><span class="line"><span class="comment">#  ssl: true</span></span><br><span class="line">  <span class="attr">index:</span> <span class="string">&#x27;misskey&#x27;</span></span><br><span class="line"><span class="comment">#  scope: local</span></span><br></pre></td></tr></table></figure><p>scopeはlocalにすると、ローカルのみ検索できるようになる<br>indexはdomain名が推奨されている模様。今回はmisskeyとした</p><h4 id="indexを張る"><a href="#indexを張る" class="headerlink" title="indexを張る"></a>indexを張る</h4><p>ここからが本番といっても過言ではないだろう。</p><iframe src="https://fedibird.com/@noellabo/111419037137255692/embed" class="mastodon-embed" style="max-width: 100%; border: 0" width="400"></iframe><script src="https://fedibird.com/embed.js" async="async"></script><p>上記の通り、<code>2023.11</code>から<code>createdAt</code>が削除されているのだ。</p><p>そのため、<a href="https://github.com/noellabo/misskey_meilisearch_importer">misskey_meilisearch_importer</a>を使ってindexを張る必要がある。</p><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/misskey</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/noellabo/misskey_meilisearch_importer.git</span><br><span class="line"><span class="built_in">cd</span> misskey_meilisearch_importer</span><br><span class="line"></span><br><span class="line">pnpm install</span><br></pre></td></tr></table></figure><figure class="highlight bash"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node importer.js --config /home/misskey/.config/default.yml</span><br></pre></td></tr></table></figure><p>これでindexが張られる。これでaid形式のインポートは終了。<code>misskey -&gt; ダッシュボード -&gt; ロール</code>よりノートの検索を有効にし、検索ができるようになる。</p><h4 id="私の場合"><a href="#私の場合" class="headerlink" title="私の場合"></a>私の場合</h4><p>まず、aidxのため、うまくいかなかった。<br>そのため、forkし、修正したものを使っている。<br><a href="https://github.com/n1lsqn/misskey_meilisearch_importer.git">misskey_meilisearch_importer</a></p><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://nanasi-apps.xyz/misskey-meilisearch">MisskeyでMeilisearchを導入するやり方</a><br><a href="https://fedibird.com/@noellabo/111419037137255692">のえるさんの投稿</a><br><a href="https://www.meilisearch.com/docs/learn/cookbooks/running_production">公式ドキュメント</a></p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;Misskeyにmeilisearchを導入する方法&quot;&gt;&lt;a href=&quot;#Misskeyにmeilisearchを導入する方法&quot; class=&quot;headerlink&quot; title=&quot;Misskeyにmeilisearchを導入する方法&quot;&gt;&lt;/a&gt;Misskeyにmeilisearchを導入する方法&lt;/h3&gt;</summary>
    
    
    
    
    <category term="misskey" scheme="https://n1lsqn.github.io/tags/misskey/"/>
    
    <category term="meilisearch" scheme="https://n1lsqn.github.io/tags/meilisearch/"/>
    
  </entry>
  
</feed>
